<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.szboanda.mobile.decision.wsgz.dao.RiverInfoDAO">
	
	<resultMap type="java.util.Map" id="HdxxMap">
		<result column="AREA" property="AREA" jdbcType="DOUBLE" javaType="double" />
		<result column="ZC" property="ZC" jdbcType="DOUBLE" javaType="double" />
	</resultMap>

	<!-- 设置业务所有字段信息 -->
	<sql id="allColumns">
		<trim prefix="" suffixOverrides="," suffix="">
		</trim>
	</sql>
	
	<!-- 查询河道信息 -->
	<select id="getHdxx" resultMap="HdxxMap">
		SELECT SUM( TO_NUMBER(SURFACE_AREA)) AREA,SUM(TO_NUMBER(LENGTH)) ZC  FROM T_WSGZ_HDXX
	</select>
	
	<!-- 查询河道信息 -->
	<select id="getHdzs" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM T_WSGZ_HDXX
	</select>
	
	<!-- 查询河长信息 -->
	<select id="getHzsl" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM T_WSGZ_HCXX
	</select>
	
	<!--  获取巡查总数-->
	<select id="getXczs" parameterType="java.lang.Boolean" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM  T_WSGZ_XCJLXX 
		WHERE 1=1
		<if test="type">
		AND TO_CHAR(START_TIME,'YYYY-MM') = TO_CHAR(SYSDATE,'YYYY-MM')
		</if>
		<if test="!type">
		AND TO_CHAR(START_TIME,'YYYY') = TO_CHAR(SYSDATE,'YYYY')
		</if>
	</select>
	
	<!-- 获取问题总数 -->
	<select id="getWtzs"  parameterType="java.lang.Boolean" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM T_WSGZ_WTJLXX WHERE 1=1
		<if test="type">
		AND TO_CHAR(REPORT_TIME,'YYYY-MM') = TO_CHAR(SYSDATE,'YYYY-MM')
		</if>
		<if test="!type">
		AND TO_CHAR(REPORT_TIME,'YYYY') = TO_CHAR(SYSDATE,'YYYY')
		</if>
	</select>
	
	<!-- 获取已解决问题总数 -->
	<select id="getHandledWtCount" parameterType="java.lang.Boolean" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM T_WSGZ_WTJLXX Where PROBLEM_STATUS = '697A4330-189C-421B-98D5-6892369F38F2'
		<if test="type">
		AND TO_CHAR(REPORT_TIME,'YYYY-MM') = TO_CHAR(SYSDATE,'YYYY-MM')
		</if>
		<if test="!type">
		AND TO_CHAR(REPORT_TIME,'YYYY') = TO_CHAR(SYSDATE,'YYYY')
		</if>
	</select>
	
	<!-- 获取共治成效占比 -->
	<select id="listZb" resultType="java.util.Map">
		SELECT 
			round(sum(case when szlb <![CDATA[<=]]> mbszlb then 1 else 0 end)/count(1),4) dbl,
			round(sum(case when szlb = 6 then 1 else 0 end)/count(1),4) lwzb
		FROM "T_WSGZ_HDSZJCSJ"
		where bgxh = (
			select xh from (
			SELECT * FROM "T_WSGZ_HDSZBG" order by jcrq desc
			)
			where rownum = 1
		)
		union
		SELECT 
			round(sum(case when szlb <![CDATA[<=]]> mbszlb then 1 else 0 end)/count(1),4) dbl,
			round(sum(case when szlb = 6 then 1 else 0 end)/count(1),4) lwzb
		FROM "T_WSGZ_HDSZJCSJ"
		where bgxh = (
			select xh from T_WSGZ_HDSZBG
			where TO_CHAR(jcrq,'yyyy-MM') = 
			TO_CHAR((
				select ADD_MONTHS(jcrq, -12) from (
					SELECT * FROM "T_WSGZ_HDSZBG" order by jcrq desc
				) where rownum = 1),'yyyy-MM')
		)
	</select>
	
	<select id="getMaxSj" resultType="java.util.Date">
		SELECT MAX(CJSJ) SJ FROM T_WSGZ_HDSZBG
	</select>
</mapper>