<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.szboanda.mobile.decision.wsgz.dao.RiverMapDAO">
	
	<resultMap type="java.util.Map" id="RiverDwMap">
		<result column="RIVER_NAME" property="riverName" jdbcType="VARCHAR" javaType="string" />
		<result column="ADMIN_DIV_NAME" property="area" jdbcType="VARCHAR" javaType="string" />
		<result column="RIVER_TYPE" property="level" jdbcType="VARCHAR" javaType="string" />
		<result column="PARENT_RIVER_CODE" property="superRiver" jdbcType="VARCHAR" javaType="string" />
		<result column="LEN" property="length" jdbcType="DOUBLE" javaType="double" />
		<result column="LOCATED_RIVER_NAME" property="areaName" jdbcType="VARCHAR" javaType="string" />
		<result column="START_POINT" property="start" jdbcType="VARCHAR" javaType="string" />
		<result column="END_POINT" property="end" jdbcType="VARCHAR" javaType="string" />
	</resultMap>
	
	<!-- 河长map -->
	<resultMap type="java.util.Map" id="HzMap">
		<result column="NAME" property="manager" jdbcType="VARCHAR" javaType="string" />
		<result column="CONTACT_NUMBER" property="phone" jdbcType="VARCHAR" javaType="string" />
		<result column="ORGANIZATION_NAME" property="dept" jdbcType="VARCHAR" javaType="string" />
		<result column="RIVER_MASTER_LEVEL" property="level" jdbcType="VARCHAR" javaType="string" />
		<result column="POSTION" property="zw" jdbcType="VARCHAR" javaType="string" />
	</resultMap>

	<!-- 设置业务所有字段信息 -->
	<sql id="allColumns">
		<trim prefix="" suffixOverrides="," suffix="">
		</trim>
	</sql>
	
	<!-- 查询河道信息 -->
	<select id="listRiverDwMap" resultType="java.util.Map">
		<!-- SELECT RIVER_ID XH,RIVER_NAME NAME,TO_NUMBER(JD) JD,TO_NUMBER(WD) WD FROM T_WSGZ_HDXX WHERE RIVER_TYPE = #{LEVEL} -->
		SELECT
			hxx.RIVER_ID XH,
			hxx.RIVER_NAME NAME,
			TO_NUMBER(hxx.JD) JD,
			TO_NUMBER(hxx.WD) WD
		FROM
			T_WSGZ_HDXX hxx LEFT JOIN T_WSGZ_HZHDGLXX twh  ON twh.RIVER_ID = hxx.RIVER_ID 
			LEFT JOIN T_WSGZ_HCXX cxx ON  cxx.RIVER_MASTER_ID = twh.RIVER_MASTER_ID
			WHERE cxx.RIVER_MASTER_LEVEL = #{LEVEL}
	</select>
	
	<!-- 获取河段信息 -->
	<select id="getRiverMap" resultMap="RiverDwMap">
		SELECT RIVER_NAME,ADMIN_DIV_NAME,RIVER_TYPE,PARENT_RIVER_CODE,TO_NUMBER(LENGTH) LEN,LOCATED_RIVER_NAME,NVL(START_POINT,'') START_POINT,NVL(END_POINT,'') END_POINT  FROM T_WSGZ_HDXX WHERE RIVER_ID = #{ID}
	</select>
	
	<!-- 获取河段名称 -->
	<select id="getSuperRiveName" resultType="string">
		SELECT RIVER_NAME FROM T_WSGZ_HDXX WHERE RIVER_CODE = #{RIVERCODE}
	</select>
	
	<!-- 河长信息 -->
	<select id="getHzxx" resultMap="HzMap">
		SELECT twh2.NAME,twh2.CONTACT_NUMBER,twh2.ORGANIZATION_NAME,twh2.RIVER_MASTER_LEVEL,twh2.POSTION FROM T_WSGZ_HZHDGLXX twh ,T_WSGZ_HCXX twh2 WHERE twh.RIVER_ID = #{ID} AND twh2.RIVER_MASTER_ID = twh.RIVER_MASTER_ID
	</select>
	
	<!-- 巡查信息 -->
	<select id="listXcxx" resultType="java.util.Map">
		SELECT xc.PATROL_ID,xc.PERSON_ID,xc.START_TIME,xc.END_TIME,trunc((xc.END_TIME - xc.START_TIME)* 24 * 60, 1) minutes,TO_NUMBER(xc."LENGTH") LEN,twh.NAME 
		FROM T_WSGZ_XCJLXX xc,T_WSGZ_HCXX twh 
		WHERE twh.RIVER_MASTER_ID = xc.PERSON_ID AND xc.RIVER_ID = #{ID} ORDER BY xc.START_TIME DESC
	</select>
	
	<!-- 问题数 -->
	<select id="getProblemCount" resultType="java.lang.Integer">
		SELECT count(*) FROM T_WSGZ_WTJLXX WHERE PATROL_ID = #{PATROLID}
	</select>
</mapper>